<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Profile · Wire</title>

  <style>
    body {
      background:#020617;
      color:#e5e7eb;
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin:0;
      padding:24px;
    }

    .container {
      max-width:640px;
      margin:0 auto;
    }

    .header {
      display:flex;
      gap:20px;
      align-items:center;
      margin-bottom:24px;
    }

    .avatar {
      width:96px;
      height:96px;
      border-radius:50%;
      background:#2563eb;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:40px;
      font-weight:700;
      flex-shrink:0;
    }

    .identity {
      flex:1;
    }

    .username {
      font-size:20px;
      font-weight:700;
    }

    .bio {
      margin-top:6px;
      color:#cbd5e1;
      font-size:14px;
      line-height:1.5;
    }

    .stats {
      display:flex;
      gap:24px;
      margin-top:14px;
    }

    .stat {
      cursor:pointer;
    }

    .stat strong {
      font-size:15px;
    }

    .stat span {
      margin-left:4px;
      color:#94a3b8;
      font-size:13px;
    }

    .section {
      border-top:1px solid #1e293b;
      padding-top:20px;
      margin-top:24px;
    }

    .field {
      margin-bottom:14px;
    }

    .label {
      font-size:12px;
      color:#94a3b8;
      margin-bottom:4px;
    }

    .value {
      font-size:14px;
      color:#e5e7eb;
    }

    .actions {
      display:flex;
      justify-content:space-between;
      margin-top:28px;
    }

    button {
      padding:10px 18px;
      border-radius:8px;
      border:none;
      font-weight:600;
      cursor:pointer;
    }

    .primary { background:#2563eb; color:white; }
    .secondary { background:#334155; color:white; }
  </style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div class="header">
    <div class="avatar" id="avatar">U</div>

    <div class="identity">
      <div class="username" id="username">username</div>
      <div class="bio" id="bio">Bio goes here</div>

      <div class="stats">
        <div class="stat" onclick="goToFriends('followers')">
          <strong id="followersCount">0</strong><span>Followers</span>
        </div>
        <div class="stat" onclick="goToFriends('following')">
          <strong id="followingCount">0</strong><span>Following</span>
        </div>
      </div>
    </div>
  </div>

  <!-- CONTACT -->
  <div class="section">
    <div class="field">
      <div class="label">Email</div>
      <div class="value" id="email">—</div>
    </div>
  </div>

  <!-- DETAILS -->
  <div class="section">
    <div class="field">
      <div class="label">Gender</div>
      <div class="value" id="gender">—</div>
    </div>

    <div class="field">
      <div class="label">Date of birth</div>
      <div class="value" id="dob">—</div>
    </div>

    <div class="field">
      <div class="label">Website</div>
      <div class="value" id="website">—</div>
    </div>

    <div class="field">
      <div class="label">Location</div>
      <div class="value" id="location">—</div>
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="actions">
    <button class="secondary" onclick="logout()">Logout</button>
    <button class="primary" onclick="enableEdit()">Edit profile</button>
  </div>

</div>

<script>
/* ======================
   AUTH GUARD (COOKIE)
   ====================== */
async function authGuard() {
  const res = await fetch("/auth/me", {
    credentials: "include"
  });

  if (res.status === 401) {
    location.replace("/login");
  }
}

authGuard();

/* ---------- REDIRECT ---------- */
function goToFriends(type) {
  location.href = `/friends-list?type=${type}`;
}

/* ---------- LOAD PROFILE ---------- */
async function loadProfile() {
  const res = await fetch("/profile/me", {
    credentials: "include"
  });

  if (!res.ok) return;

  const p = await res.json();

  username.innerText = p.username || "user";
  bio.innerText = p.bio || "No bio yet";
  email.innerText = p.email || "—";
  gender.innerText = p.gender || "—";
  dob.innerText = p.date_of_birth || "—";
  website.innerText = p.website || "—";
  location.innerText = p.location || "—";

  avatar.innerText = (p.username || "U")[0].toUpperCase();
}

/* ---------- LOAD COUNTS ---------- */
async function loadCounts() {
  const followers = await fetch("/friends/followers", {
    credentials: "include"
  }).then(r => r.json());

  const following = await fetch("/friends/following", {
    credentials: "include"
  }).then(r => r.json());

  followersCount.innerText = followers.count;
  followingCount.innerText = following.count;
}

/* ---------- ACTIONS ---------- */
function enableEdit() {
  location.href = "/profile/edit";
}

async function logout() {
  await fetch("/auth/logout", {
    method: "POST",
    credentials: "include"
  });

  location.replace("/login");
}

loadProfile();
loadCounts();
</script>
</body>
</html>