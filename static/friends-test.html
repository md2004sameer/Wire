<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Friends API Test</title>
  <style>
    body { font-family: system-ui; padding: 20px; }
    input { padding: 6px; }
    button { margin: 4px; padding: 6px 10px; }
    pre { background: #f3f4f6; padding: 10px; }
  </style>
</head>
<body>

<h2>Friends API Test</h2>

<label>Target username:</label>
<input id="username" placeholder="username">
<br><br>

<button onclick="checkStatus()">Check Status</button>
<button onclick="follow()">Follow</button>
<button onclick="accept()">Accept</button>
<button onclick="removeRel()">Remove</button>

<h3>Output</h3>
<pre id="out"></pre>

<script>
const token = localStorage.getItem("access_token");
if (!token) location.href = "/login";

const out = document.getElementById("out");

function show(data) {
  out.textContent = JSON.stringify(data, null, 2);
}

async function req(url, method="GET", body=null) {
  const res = await fetch(url, {
    method,
    headers: {
      "Authorization": "Bearer " + token,
      "Content-Type": "application/json"
    },
    body: body ? JSON.stringify(body) : null
  });

  const data = await res.json().catch(() => ({}));
  show({ status: res.status, data });
}

function checkStatus() {
  const u = username.value.trim();
  req(`/friends/status/${u}`);
}

function follow() {
  req("/friends/follow", "POST", { username: username.value.trim() });
}

function accept() {
  req("/friends/accept", "POST", { username: username.value.trim() });
}

function removeRel() {
  req("/friends/remove", "POST", { username: username.value.trim() });
}
</script>

</body>
</html>